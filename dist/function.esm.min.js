/*!
 * YCL public function Library by @YCL with MIT License
 * Built: 2026-02-22
 */
const e=(()=>{const e="__APP_RUNTIME_DEBUG__",{hostname:r,search:t}=window.location,o=new URLSearchParams(t),n=/^(localhost|127\.0\.0\.1|::1|192\.168\.|172\.(1[6-9]|2[0-9]|3[0-1])\.|10\.)/i.test(r),s=o.get("debug"),a=["1","true","dev","admin"].includes(s),i="false"===s||"0"===s||o.has("debug")&&!a;let c=!1;if(a){c=!0;try{sessionStorage.setItem(e,"1")}catch(e){}}else if(i){c=!1;try{sessionStorage.removeItem(e)}catch(e){}}else c=n||"1"===sessionStorage.getItem(e);return()=>c})(),r=(()=>{if(navigator.userAgentData&&void 0!==navigator.userAgentData.mobile){const e=navigator.userAgentData.mobile;return()=>e}const e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches,r="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,t=navigator.userAgent||navigator.vendor||window.opera||"",o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t),n=e||r||o;return()=>n})();function t(e){const r=window.location.search,t=new URLSearchParams(r);if(e){const r=t.get(e);return null===r?void 0:r}{const e={};for(const[r,o]of t.entries())e[r]=o;return e}}function o(e=32){const r=new Array(e);for(let t=0;t<e;t++)r[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return r.join("")}function n(e,r,t=!1,o=!1){return"undefined"!=typeof document&&document.head?new Promise((n,s)=>{let a;switch(r){case"css":a=document.createElement("link"),a.rel="stylesheet",a.href=e;break;case"js":a=document.createElement("script"),a.src=e,a.async=o,t&&(a.type="module");break;default:return s(new Error(`loadExternalResource: Invalid type "${r}".`))}a.onload=n,a.onerror=()=>s(new Error(`Failed to load resource: ${e}`)),document.head.appendChild(a)}):Promise.reject(new Error("loadExternalResource: Must be executed in DOM environment."))}async function s(e,r=!1){if(!Array.isArray(e)||0===e.length)return r&&console.warn("TestURLs 数组为空或无效。"),[];const t=await Promise.all(e.map(async(e,r)=>{const t=new AbortController,o=performance.now();let n;const s=new Promise((e,r)=>{n=setTimeout(()=>{t.abort(),r(new Error("Timeout after 3000ms"))},3e3)});try{const a=`${e.endsWith("/")?e:e+"/"}test.bin`,i=fetch(a,{signal:t.signal}),c=await Promise.race([i,s]);if(clearTimeout(n),!c.ok)throw new Error(`HTTP Error: ${c.status} ${c.statusText||""}`);return await c.arrayBuffer(),{url:e,elapsedTime:performance.now()-o,isError:!1,error:null,index:r}}catch(t){return clearTimeout(n),{url:e,elapsedTime:performance.now()-o,isError:!0,error:t.message||t.toString(),index:r}}})),o=t.filter(e=>!e.isError),n=o.length>0?Math.min(...o.map(e=>e.elapsedTime)):1/0,s=t.map(e=>({url:e.url,elapsedTime:Number(e.elapsedTime.toFixed(2)),isError:e.isError,errorMessage:e.error,isFastest:!e.isError&&e.elapsedTime===n}));return r&&s.forEach(e=>{const r=e.isFastest?"#00ff7f":e.elapsedTime<1e3?"#ffff00":"#ffffff",t=e.isError?"#ff4500":"#32cd32";console.log(`%c[${e.isFastest?"FASTEST":"NORMAL"}] %cURL: ${e.url} | %c耗时: ${e.elapsedTime}ms | %c出错: ${e.isError}`,"font-weight: bold; color: "+(e.isFastest?"#00ff7f":"#1e90ff"),"color: #ffffff",`color: ${r}; font-weight: bold;`,`color: ${t}; font-weight: bold;`),e.isError&&console.log(`%c错误信息: ${e.errorMessage}`,"color:red")}),s}class a{static#e=new Map;static openDatabase(e,r){if(!("indexedDB"in window))return Promise.reject(new Error("IndexedDB is not supported in this environment."));if(this.#e.has(e))return this.#e.get(e);const t=new Promise((t,o)=>{const n=indexedDB.open(e,1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(r)||t.createObjectStore(r)},n.onsuccess=r=>{const o=r.target.result;o.onclose=()=>this.#e.delete(e),t(o)},n.onerror=r=>{this.#e.delete(e),o(new Error(`IndexedDB open error: ${r.target.error.name}`))}});return this.#e.set(e,t),t}static#r(e,r,t,o){return new Promise((n,s)=>{const a=e.transaction([r],t),i=a.objectStore(r),c=o(i);a.oncomplete=()=>n(c.result),a.onerror=e=>s(new Error(`Transaction error: ${e.target.error.name}`)),c.onerror=e=>s(new Error(`Request error: ${e.target.error.name}`))})}static async saveToIndexedDB(e,r,t,o){const n=await this.openDatabase(e,r);await this.#r(n,r,"readwrite",e=>e.put(o,t))}static async getFromIndexedDB(e,r,t){const o=await this.openDatabase(e,r);return this.#r(o,r,"readonly",e=>e.get(t))}}class i{#t=!1;#o=new Map;constructor(e=!1){this.#t=e}setEnable(e=!1){this.#t=e,this.#t||this.#o.clear()}Start(e="noname"){this.#t&&this.#o.set(e,performance.now())}Stop(e="noname",r=""){if(!this.#t)return;const t=this.#o.get(e);if(!t)return;const o=performance.now()-t;return"undefined"!=typeof console&&console.log(`${r||e}: %c${o}ms`,"color: #6495ed"),this.#o.delete(e),o}}export{i as DbgTimmer,a as IndexedDBControl,o as RandomString,s as ServerChoose,t as getUrlParams,e as isDebug,r as isMobile,n as loadExternalResource};
