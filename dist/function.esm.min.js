/*!
 * YCL public function Library by @YCL with MIT License
 * Built: 2026-01-12
 */
function e(){const e=void 0!==t("debug"),r=/^localhost|^127(?:\.0(?:\.0(?:\.0?)?)?\.0?)|(?:0*:)?::1$/i.test(window.location.hostname);return e||r}function r(){const e=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini|SymbianOS|Windows Phone|iPad/i.test(navigator.userAgent),r=window.innerWidth<768,t="ontouchstart"in window||navigator.maxTouchPoints>0;return e||t&&r}function t(e){const r=window.location.search,t=new URLSearchParams(r);if(e){const r=t.get(e);return null===r?void 0:r}{const e={};for(const[r,n]of t.entries())e[r]=n;return e}}function n(e=32){const r=new Array(e);for(let t=0;t<e;t++)r[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return r.join("")}function o(e,r,t=!1,n=!1){return"undefined"!=typeof document&&document.head?new Promise((o,s)=>{let a;switch(r){case"css":a=document.createElement("link"),a.rel="stylesheet",a.href=e;break;case"js":a=document.createElement("script"),a.src=e,a.async=n,t&&(a.type="module");break;default:return s(new Error(`loadExternalResource: Invalid type "${r}".`))}a.onload=o,a.onerror=()=>s(new Error(`Failed to load resource: ${e}`)),document.head.appendChild(a)}):Promise.reject(new Error("loadExternalResource: Must be executed in DOM environment."))}async function s(e,r=!1){if(!Array.isArray(e)||0===e.length)return r&&console.warn("TestURLs 数组为空或无效。"),[];const t=await Promise.all(e.map(async(e,r)=>{const t=new AbortController,n=performance.now();let o;const s=new Promise((e,r)=>{o=setTimeout(()=>{t.abort(),r(new Error("Timeout after 3000ms"))},3e3)});try{const a=`${e.endsWith("/")?e:e+"/"}test.bin`,i=fetch(a,{signal:t.signal}),c=await Promise.race([i,s]);if(clearTimeout(o),!c.ok)throw new Error(`HTTP Error: ${c.status} ${c.statusText||""}`);return await c.arrayBuffer(),{url:e,elapsedTime:performance.now()-n,isError:!1,error:null,index:r}}catch(t){return clearTimeout(o),{url:e,elapsedTime:performance.now()-n,isError:!0,error:t.message||t.toString(),index:r}}})),n=t.filter(e=>!e.isError),o=n.length>0?Math.min(...n.map(e=>e.elapsedTime)):1/0,s=t.map(e=>({url:e.url,elapsedTime:Number(e.elapsedTime.toFixed(2)),isError:e.isError,errorMessage:e.error,isFastest:!e.isError&&e.elapsedTime===o}));return r&&s.forEach(e=>{const r=e.isFastest?"#00ff7f":e.elapsedTime<1e3?"#ffff00":"#ffffff",t=e.isError?"#ff4500":"#32cd32";console.log(`%c[${e.isFastest?"FASTEST":"NORMAL"}] %cURL: ${e.url} | %c耗时: ${e.elapsedTime}ms | %c出错: ${e.isError}`,"font-weight: bold; color: "+(e.isFastest?"#00ff7f":"#1e90ff"),"color: #ffffff",`color: ${r}; font-weight: bold;`,`color: ${t}; font-weight: bold;`),e.isError&&console.log(`%c错误信息: ${e.errorMessage}`,"color:red")}),s}class a{static#e=new Map;static openDatabase(e,r){if(!("indexedDB"in window))return Promise.reject(new Error("IndexedDB is not supported in this environment."));if(this.#e.has(e))return this.#e.get(e);const t=new Promise((t,n)=>{const o=indexedDB.open(e,1);o.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(r)||t.createObjectStore(r)},o.onsuccess=r=>{const n=r.target.result;n.onclose=()=>this.#e.delete(e),t(n)},o.onerror=r=>{this.#e.delete(e),n(new Error(`IndexedDB open error: ${r.target.error.name}`))}});return this.#e.set(e,t),t}static#r(e,r,t,n){return new Promise((o,s)=>{const a=e.transaction([r],t),i=a.objectStore(r),c=n(i);a.oncomplete=()=>o(c.result),a.onerror=e=>s(new Error(`Transaction error: ${e.target.error.name}`)),c.onerror=e=>s(new Error(`Request error: ${e.target.error.name}`))})}static async saveToIndexedDB(e,r,t,n){const o=await this.openDatabase(e,r);await this.#r(o,r,"readwrite",e=>e.put(n,t))}static async getFromIndexedDB(e,r,t){const n=await this.openDatabase(e,r);return this.#r(n,r,"readonly",e=>e.get(t))}}class i{#t=!1;#n=new Map;constructor(e=!1){this.#t=e}setEnable(e=!1){this.#t=e,this.#t||this.#n.clear()}Start(e="noname"){this.#t&&this.#n.set(e,performance.now())}Stop(e="noname",r=""){if(!this.#t)return;const t=this.#n.get(e);if(!t)return;const n=performance.now()-t;return"undefined"!=typeof console&&console.log(`${r||e}: %c${n}ms`,"color: #6495ed"),this.#n.delete(e),n}}export{i as DbgTimmer,a as IndexedDBControl,n as RandomString,s as ServerChoose,t as getUrlParams,e as isDebug,r as isMobile,o as loadExternalResource};
